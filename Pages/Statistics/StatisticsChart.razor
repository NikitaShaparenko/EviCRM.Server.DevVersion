@page "/stats_marks"

<PageTitle>Статистика по оценкам</PageTitle>
<h5>Статистика по оценкам</h5>

@using Blazorise.Charts
@using EviCRM.Server.Core
@using EviCRM.Server.Models.Statistics
@using EviCRM.Server.ViewModels;

@using Newtonsoft.Json
@using Newtonsoft.Json.Linq

@inject Context _context
@inject BackendController bc
@inject SystemCore sc
@inject Sentinel sentinel
@inject LiveNature liven

@inject AuthenticationStateProvider authStateProvider

@inject ILocalStorageService _localStorageService
@inject IToastService _toastService
@inject IJSRuntime JS

@inject IWebHostEnvironment _env;

@inject NavigationManager uriHelper;

<AuthorizeView>
    <Authorized>

        @if (ready)
        {

            @if (personal)
            {
                 <div class="input-group">
                    <div class="p-2">
                        <select value="@StatWindowString2" @onchange="((e) => StatWindowStringChanger(e))" class="me-2">
                            <option value="@StatWindow.common">Сводная</option>
                            <option value="@StatWindow.personal" active>Персональная</option>
                        </select>
                    </div>

                    <div class="p-2">
                        <select value="@personal_users" @onchange="((e) => PersonalUserChanger(e))" class="me-2">
                            @if (Users.Count > 0)
                            {
                                 @foreach(var elem in Users)
                                 {
                                    <option value="@elem.id.ToString()">@elem.fullname</option>
                                 }
                            }
                        </select>
                    </div>

                    </div>

                    @if (isPersonalStatVisible)
                    {
                         <EviCRM.Server.Pages.Statistics.StatisticsPersonalCharts 
                         
                         current_user_id=@Selected_User.id.ToString()
                         Marks=@Marks
                         Users=@Users

                         />
                    }

                    }

            @if (!personal)
            {
                <div class="input-group">
                    <div class="p-2">
                        <select value="@StatWindowString" @onchange="((e) => StatWindowStringChanger(e))" class="me-2">
                            <option value="@StatWindow.common" active>Сводная</option>
                            <option value="@StatWindow.personal">Персональная</option>
                        </select>
                    </div>

                    <div class="p-2">
                        <select value="@InterpolationCatsString" @onchange=InterpolationCatsStringHandler class="me-2">
                            <option value="@InterpolationCats.disabled">Без интерполяции</option>
                            <option value="@InterpolationCats.enabled">Линейная интерполяция</option>
                            <option value="@InterpolationCats.stepbefore">Пошаговая интерполяция Step Before</option>
                            <option value="@InterpolationCats.stepafter">Пошаговая интерполяция Step After</option>
                            <option value="@InterpolationCats.stepmiddle">Пошаговая интерполяция Step Middle</option>
                        </select>
                    </div>

                      <div class="p-2">
                        <select @bind="isPieString" class="me-2">
                            <option value="True">Круговые графики</option>
                            <option value="False">Столбчатые графики</option>
                        </select>
                        </div>
                    <div class="p-2">
                            <label><input value=@isOnlyWithMarks type="checkbox" id="marks_only" name="marks_only" @onchange=@isOnlyWithMarksHandler> Только с оценками </label>
                    </div>

                    <div class="p-2">
                        <input type="checkbox" id="isTop" name="isTop" value=@isOnlyWithMarks  @onchange=@isTopChange/>

                        <label>Только ТОП-<input type="number" min="0" style="width:100px" max="@Users.Count" value=@TopNumber name="charts_num" @onchange=@topnumber_changed /></label>
                    </div>
                </div>

                <div class="row">
                    <div class="col-lg-12">
                        <div class="card">
                            <div class="card-body">

                                <p><div class="input-group">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text">Начало и конец обзора</span>
                                        </div>
                                        <input type="date" placeholder="Начало выполнения" value=@(dt_start.ToString("dd-MM-yyyy")) name="event_start" @onchange="@((ChangeEventArgs e) => DateStartChangeHandler(e))" />
                                        <input type="date" placeholder="Планируемое окончание" value=@(dt_end.ToString("dd-MM-yyyy")) name="event_end" @onchange="@((ChangeEventArgs e) => DateEndChangeHandler(e))"/>
                                    </div></p>

                                <div class="table-responsive">
                                    
                                    @if (!Double.IsNaN(avg_company))
                                    {
                                        <p><i>Общий cредний балл по коллективу: </i> <b>@avg_company.ToString("N3")</b></p>
                                    }
                                    else
                                    {
                                        <p><i>Общий cредний балл по коллективу: </i> <b>Невозможно посчитать</b></p>
                                    }

                                    @if (!Double.IsNaN(academic_perfomace_company))
                                    {
                                        <p><i>"Успеваемость коллектива": </i> <b>@academic_perfomace_company.ToString("N3")</b><br>
                                        <sub>Формула = ( все 5 + 4 + 3 ) / кол-во работников</sub></p>
                                    }
                                    else
                                    {
                                        <p><i>"Успеваемость коллектива": </i> <b>Невозможно посчитать</b></p>
                                       
                                    }

                                    @if (!Double.IsNaN(quality_of_work_company))
                                    {
                                        <p><i>"Качество работы": </i> <b>@quality_of_work_company.ToString("N3")</b><br>
                                        <sub>Формула = ( все 5 + 4 ) / кол-во работников</sub></p>
                                    }
                                    else
                                    {
                                        <p><i>"Качество работы": </i> <b>Невозможно посчитать</b></p>
                                    }

                                    @if (!Double.IsNaN(perfomance_company))
                                    {
                                        <p><i>"Эффективность": </i><b>@perfomance_company.ToString("N3")</b><br>
                                        <sub>Формула = ( все 5 + все 4 * 0,64 + все 3 * 0,36 + все 2 * 0,16 + все 1 * 0,08 )</sub></p>
                                    }
                                    else
                                    {
                                        <p><i>"Эффективность":</i><b>Невозможно посчитать</b></p>
                                    }

                                  <p></p>

                                    <table class="table align-middle table-nowrap table-hover">
                                        <thead class="table-light">
                                            <tr>
                                                <th scope="col" style="width: 70px;" text-align="center">#</th>
                                                <th scope="col" @onclick="@(()=>ModelSort("name"))" text-align="center"><button type="button" class="btn btn-primary"><i class="bx bx-sort"></i>Имя</button></th>
                                                <th scope="col" style="width: 500px;" text-align="center" align-middle>Общее распределение оценок</th>
                                                <th scope="col" @onclick="@ModelSort" text-align="center"><button type="button" class="btn btn-primary"><i class="bx bx-sort"></i>Средний балл</button></th>
                                                <th scope="col" width="500px" text-align="center" align-middle>Тренды среднего балла</th>
                                                <th scope="col" @onclick="@ModelSort" text-align="center"><button type="button" class="btn btn-primary"><i class="bx bx-sort"></i>Отклонение среднего балла</button></th>
                                            </tr>
                                        </thead>

                                        <tbody>
                                              @{
                                                int i_cnt = 0;
                                                int top_number = 0;
                                            }   

                                            @foreach (var elem in svmp_main)
                                            {
                                                int i_visible = i_cnt+1;
                                                int i_e = i_cnt;
                                                int lcl_view = i_e;
                                                int lcl_view_plus = i_cnt + 1;
                                                top_number = top_number+1;

                                                    bool isinMark = false;

                                                    isinMark = elem.isContainsMark();

                                                    if ((isinMark && isOnlyWithMarks) || (!isOnlyWithMarks))
                                                    {
                                                        if ((isTop && (top_number <= TopNumber))||(!isTop))
                                                        {
                                                        <tr>
                                                            <td>@i_visible</td>
                                                            <td>@elem.user_fullname</td>

                                                            <td>
                                                                <div style="position: relative; margin-left: auto; margin-right: auto;">
                                                                   
                                                                   @switch (lcl_view_plus)
                                                                    {
                                                                       case 1:
                                                                       @if(isPie){
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.PieChartListInteropModule @ref=_pclim_1 co=@elem.pieOption pcd=@elem.pieDatasetList lbls=@elem.pieDatasetLabels/>
                                                                        }
                                                                        else
                                                                        {
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.BarChartListInteropModule @ref=_bclim_1 co=@elem.barOption  pcd=@elem.pieDatasetList bcd=@elem.barDatasetList lbls=@elem.barDatasetLabels/>
                                                                        }
                                                                         break;
                                                                    case 2:
                                                                     @if(isPie){
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.PieChartListInteropModule @ref=_pclim_2  co=@elem.pieOption pcd=@elem.pieDatasetList lbls=@elem.pieDatasetLabels/>
                                                                       }
                                                                        else
                                                                        {
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.BarChartListInteropModule @ref=_bclim_2 co=@elem.barOption pcd=@elem.pieDatasetList bcd=@elem.barDatasetList lbls=@elem.barDatasetLabels/> 
                                                                        }
                                                                         break;
                                                                      case 3:
                                                                       @if(isPie){
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.PieChartListInteropModule @ref=_pclim_3  co=@elem.pieOption pcd=@elem.pieDatasetList lbls=@elem.pieDatasetLabels/>
                                                                        }
                                                                        else
                                                                        {
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.BarChartListInteropModule @ref=_bclim_3 co=@elem.barOption pcd=@elem.pieDatasetList bcd=@elem.barDatasetList lbls=@elem.barDatasetLabels/>
                                                                        }
                                                                         break;
                                                                      case 4:
                                                                       @if(isPie){
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.PieChartListInteropModule @ref=_pclim_4  co=@elem.pieOption pcd=@elem.pieDatasetList lbls=@elem.pieDatasetLabels/>
                                                                      }
                                                                        else
                                                                        {
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.BarChartListInteropModule @ref=_bclim_4 co=@elem.barOption pcd=@elem.pieDatasetList bcd=@elem.barDatasetList lbls=@elem.barDatasetLabels/>
                                                                        }
                                                                         break;
                                                                      case 5:
                                                                       @if(isPie){
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.PieChartListInteropModule @ref=_pclim_5  co=@elem.pieOption pcd=@elem.pieDatasetList lbls=@elem.pieDatasetLabels/>
                                                                      }
                                                                        else
                                                                        {
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.BarChartListInteropModule @ref=_bclim_5 co=@elem.barOption pcd=@elem.pieDatasetList bcd=@elem.barDatasetList lbls=@elem.barDatasetLabels/>
                                                                        }
                                                                         break;
                                                                      case 6:
                                                                       @if(isPie){
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.PieChartListInteropModule @ref=_pclim_6  co=@elem.pieOption pcd=@elem.pieDatasetList lbls=@elem.pieDatasetLabels/>
                                                                       }
                                                                        else
                                                                        {
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.BarChartListInteropModule @ref=_bclim_6 co=@elem.barOption pcd=@elem.pieDatasetList bcd=@elem.barDatasetList lbls=@elem.barDatasetLabels/>
                                                                        }
                                                                         break;
                                                                      case 7:
                                                                       @if(isPie){
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.PieChartListInteropModule @ref=_pclim_7  co=@elem.pieOption pcd=@elem.pieDatasetList lbls=@elem.pieDatasetLabels/>
                                                                       }
                                                                        else
                                                                        {
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.BarChartListInteropModule @ref=_bclim_7 co=@elem.barOption pcd=@elem.pieDatasetList bcd=@elem.barDatasetList lbls=@elem.barDatasetLabels/>
                                                                        }
                                                                         break;
                                                                      case 8:
                                                                       @if(isPie){
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.PieChartListInteropModule @ref=_pclim_8  co=@elem.pieOption pcd=@elem.pieDatasetList lbls=@elem.pieDatasetLabels/>
                                                                       }
                                                                        else
                                                                        {
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.BarChartListInteropModule @ref=_bclim_8 co=@elem.barOption pcd=@elem.pieDatasetList bcd=@elem.barDatasetList lbls=@elem.barDatasetLabels/>
                                                                        }
                                                                         break;
                                                                      case 9:
                                                                       @if(isPie){
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.PieChartListInteropModule @ref=_pclim_9  co=@elem.pieOption pcd=@elem.pieDatasetList lbls=@elem.pieDatasetLabels/>
                                                                       }
                                                                        else
                                                                        {
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.BarChartListInteropModule @ref=_bclim_9 co=@elem.barOption pcd=@elem.pieDatasetList bcd=@elem.barDatasetList lbls=@elem.barDatasetLabels/>
                                                                        }
                                                                        break;
                                                                      case 10:
                                                                       @if(isPie){
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.PieChartListInteropModule @ref=_pclim_10  co=@elem.pieOption pcd=@elem.pieDatasetList lbls=@elem.pieDatasetLabels/>
                                                                      }
                                                                        else
                                                                        {
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.BarChartListInteropModule @ref=_bclim_10 co=@elem.barOption pcd=@elem.pieDatasetList bcd=@elem.barDatasetList lbls=@elem.barDatasetLabels/>
                                                                        }
                                                                         break;
                                                                      case 11:
                                                                       @if(isPie){
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.PieChartListInteropModule @ref=_pclim_11  co=@elem.pieOption pcd=@elem.pieDatasetList lbls=@elem.pieDatasetLabels/>
                                                                       }
                                                                        else
                                                                        {
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.BarChartListInteropModule @ref=_bclim_11 co=@elem.barOption pcd=@elem.pieDatasetList bcd=@elem.barDatasetList lbls=@elem.barDatasetLabels/>
                                                                        }
                                                                         break;
                                                                      case 12:
                                                                       @if(isPie){
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.PieChartListInteropModule @ref=_pclim_12  co=@elem.pieOption pcd=@elem.pieDatasetList lbls=@elem.pieDatasetLabels/>
                                                                       }
                                                                        else
                                                                        {
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.BarChartListInteropModule @ref=_bclim_12 co=@elem.barOption pcd=@elem.pieDatasetList bcd=@elem.barDatasetList lbls=@elem.barDatasetLabels/>
                                                                        }
                                                                         break;
                                                                      case 13:
                                                                       @if(isPie){
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.PieChartListInteropModule @ref=_pclim_13  co=@elem.pieOption pcd=@elem.pieDatasetList lbls=@elem.pieDatasetLabels/>
                                                                       }
                                                                        else
                                                                        {
                                                                            <EviCRM.Server.Pages.Charts.ChartListInterop.BarChartListInteropModule @ref=_bclim_13 co=@elem.barOption pcd=@elem.pieDatasetList bcd=@elem.barDatasetList lbls=@elem.barDatasetLabels/>
                                                                        }
                                                                            break;
                                                                          case 14:
                                                                           @if(isPie){
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.PieChartListInteropModule @ref=_pclim_14  co=@elem.pieOption pcd=@elem.pieDatasetList lbls=@elem.pieDatasetLabels/>
                                                                        }
                                                                        else
                                                                        {
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.BarChartListInteropModule @ref=_bclim_14 co=@elem.barOption pcd=@elem.pieDatasetList bcd=@elem.barDatasetList lbls=@elem.barDatasetLabels/>
                                                                        }
                                                                         break;
                                                                          case 15:
                                                                           @if(isPie){
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.PieChartListInteropModule @ref=_pclim_15  co=@elem.pieOption pcd=@elem.pieDatasetList lbls=@elem.pieDatasetLabels/>
                                                                       }
                                                                        else
                                                                        {
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.BarChartListInteropModule @ref=_bclim_15 co=@elem.barOption pcd=@elem.pieDatasetList bcd=@elem.barDatasetList lbls=@elem.barDatasetLabels/>
                                                                        }
                                                                         break;
                                                                          case 16:
                                                                           @if(isPie){
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.PieChartListInteropModule @ref=_pclim_16  co=@elem.pieOption pcd=@elem.pieDatasetList lbls=@elem.pieDatasetLabels/>
                                                                      }
                                                                        else
                                                                        {
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.BarChartListInteropModule @ref=_bclim_16 co=@elem.barOption pcd=@elem.pieDatasetList bcd=@elem.barDatasetList lbls=@elem.barDatasetLabels/>
                                                                        }
                                                                         break;
                                                                          case 17:
                                                                           @if(isPie){
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.PieChartListInteropModule @ref=_pclim_17  co=@elem.pieOption pcd=@elem.pieDatasetList lbls=@elem.pieDatasetLabels/>
                                                                      }
                                                                        else
                                                                        {
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.BarChartListInteropModule @ref=_bclim_17 co=@elem.barOption pcd=@elem.pieDatasetList bcd=@elem.barDatasetList lbls=@elem.barDatasetLabels/>
                                                                        }
                                                                         break;
                                                                          case 18:
                                                                           @if(isPie){
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.PieChartListInteropModule @ref=_pclim_18  co=@elem.pieOption pcd=@elem.pieDatasetList lbls=@elem.pieDatasetLabels/>
                                                                      }
                                                                        else
                                                                        {
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.BarChartListInteropModule @ref=_bclim_18 co=@elem.barOption pcd=@elem.pieDatasetList bcd=@elem.barDatasetList lbls=@elem.barDatasetLabels/>
                                                                        }
                                                                         break;
                                                                          case 19:
                                                                           @if(isPie){
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.PieChartListInteropModule @ref=_pclim_19  co=@elem.pieOption pcd=@elem.pieDatasetList lbls=@elem.pieDatasetLabels/>
                                                                      }
                                                                        else
                                                                        {
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.BarChartListInteropModule @ref=_bclim_19 co=@elem.barOption pcd=@elem.pieDatasetList bcd=@elem.barDatasetList lbls=@elem.barDatasetLabels/>
                                                                        }
                                                                         break;
                                                                          case 20:
                                                                           @if(isPie){
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.PieChartListInteropModule @ref=_pclim_20  co=@elem.pieOption pcd=@elem.pieDatasetList lbls=@elem.pieDatasetLabels/>
                                                                      }
                                                                        else
                                                                        {
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.BarChartListInteropModule @ref=_bclim_20 co=@elem.barOption pcd=@elem.pieDatasetList bcd=@elem.barDatasetList lbls=@elem.barDatasetLabels/>
                                                                        }
                                                                         break;
                                                                          case 21:
                                                                           @if(isPie){
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.PieChartListInteropModule @ref=_pclim_21  co=@elem.pieOption pcd=@elem.pieDatasetList lbls=@elem.pieDatasetLabels/>
                                                                      }
                                                                        else
                                                                        {
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.BarChartListInteropModule @ref=_bclim_21 co=@elem.barOption pcd=@elem.pieDatasetList bcd=@elem.barDatasetList lbls=@elem.barDatasetLabels/>
                                                                        }
                                                                         break;
                                                                          case 22:
                                                                           @if(isPie){
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.PieChartListInteropModule @ref=_pclim_22  co=@elem.pieOption pcd=@elem.pieDatasetList lbls=@elem.pieDatasetLabels/>
                                                                      }
                                                                        else
                                                                        {
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.BarChartListInteropModule @ref=_bclim_22 co=@elem.barOption pcd=@elem.pieDatasetList bcd=@elem.barDatasetList lbls=@elem.barDatasetLabels/>
                                                                        }
                                                                         break;
                                                                          case 23:
                                                                           @if(isPie){
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.PieChartListInteropModule @ref=_pclim_23  co=@elem.pieOption pcd=@elem.pieDatasetList lbls=@elem.pieDatasetLabels/>
                                                                      }
                                                                        else
                                                                        {
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.BarChartListInteropModule @ref=_bclim_23 co=@elem.barOption pcd=@elem.pieDatasetList bcd=@elem.barDatasetList lbls=@elem.barDatasetLabels/>
                                                                        }
                                                                         break;
                                                                          case 24:
                                                                           @if(isPie){
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.PieChartListInteropModule @ref=_pclim_24  co=@elem.pieOption pcd=@elem.pieDatasetList lbls=@elem.pieDatasetLabels/>
                                                                      }
                                                                        else
                                                                        {
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.BarChartListInteropModule @ref=_bclim_24 co=@elem.barOption pcd=@elem.pieDatasetList bcd=@elem.barDatasetList lbls=@elem.barDatasetLabels/>
                                                                        }
                                                                         break;
                                                                          case 25:
                                                                           @if(isPie){
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.PieChartListInteropModule @ref=_pclim_25  co=@elem.pieOption pcd=@elem.pieDatasetList lbls=@elem.pieDatasetLabels/>
                                                                      }
                                                                        else
                                                                        {
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.BarChartListInteropModule @ref=_bclim_25 co=@elem.barOption pcd=@elem.pieDatasetList bcd=@elem.barDatasetList lbls=@elem.barDatasetLabels/>
                                                                        }
                                                                         break;
                                                                          case 26:
                                                                           @if(isPie){
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.PieChartListInteropModule @ref=_pclim_26  co=@elem.pieOption pcd=@elem.pieDatasetList lbls=@elem.pieDatasetLabels/>
                                                                      }
                                                                        else
                                                                        {
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.BarChartListInteropModule @ref=_bclim_26 co=@elem.barOption pcd=@elem.pieDatasetList bcd=@elem.barDatasetList lbls=@elem.barDatasetLabels/>
                                                                        }
                                                                         break;
                                                                          case 27:
                                                                           @if(isPie){
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.PieChartListInteropModule @ref=_pclim_27  co=@elem.pieOption pcd=@elem.pieDatasetList lbls=@elem.pieDatasetLabels/>
                                                                      }
                                                                        else
                                                                        {
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.BarChartListInteropModule @ref=_bclim_27 co=@elem.barOption pcd=@elem.pieDatasetList bcd=@elem.barDatasetList lbls=@elem.barDatasetLabels/>
                                                                        }
                                                                         break;
                                                                          case 28:
                                                                           @if(isPie){
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.PieChartListInteropModule @ref=_pclim_28  co=@elem.pieOption pcd=@elem.pieDatasetList lbls=@elem.pieDatasetLabels/>
                                                                      }
                                                                        else
                                                                        {
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.BarChartListInteropModule @ref=_bclim_28 co=@elem.barOption pcd=@elem.pieDatasetList bcd=@elem.barDatasetList lbls=@elem.barDatasetLabels/>
                                                                        }
                                                                         break;
                                                                          case 29:
                                                                           @if(isPie){
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.PieChartListInteropModule @ref=_pclim_29  co=@elem.pieOption pcd=@elem.pieDatasetList lbls=@elem.pieDatasetLabels/>
                                                                      }
                                                                        else
                                                                        {
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.BarChartListInteropModule @ref=_bclim_29 co=@elem.barOption pcd=@elem.pieDatasetList bcd=@elem.barDatasetList lbls=@elem.barDatasetLabels/>
                                                                        }
                                                                         break;
                                                                          case 30:
                                                                           @if(isPie){
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.PieChartListInteropModule @ref=_pclim_30  co=@elem.pieOption pcd=@elem.pieDatasetList lbls=@elem.pieDatasetLabels/>
                                                                      }
                                                                        else
                                                                        {
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.BarChartListInteropModule @ref=_bclim_30 co=@elem.barOption pcd=@elem.pieDatasetList bcd=@elem.barDatasetList lbls=@elem.barDatasetLabels/>
                                                                        }
                                                                         break;
                                                                          case 31:
                                                                           @if(isPie){
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.PieChartListInteropModule @ref=_pclim_31  co=@elem.pieOption pcd=@elem.pieDatasetList lbls=@elem.pieDatasetLabels/>
                                                                      }
                                                                        else
                                                                        {
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.BarChartListInteropModule @ref=_bclim_31 co=@elem.barOption pcd=@elem.pieDatasetList bcd=@elem.barDatasetList lbls=@elem.barDatasetLabels/>
                                                                        }
                                                                         break;
                                                                          case 32:
                                                                           @if(isPie){
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.PieChartListInteropModule @ref=_pclim_32  co=@elem.pieOption pcd=@elem.pieDatasetList lbls=@elem.pieDatasetLabels/>
                                                                      }
                                                                        else
                                                                        {
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.BarChartListInteropModule @ref=_bclim_32 co=@elem.barOption pcd=@elem.pieDatasetList bcd=@elem.barDatasetList lbls=@elem.barDatasetLabels/>
                                                                        }
                                                                         break;
                                                                          case 33:
                                                                           @if(isPie){
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.PieChartListInteropModule @ref=_pclim_33  co=@elem.pieOption pcd=@elem.pieDatasetList lbls=@elem.pieDatasetLabels/>
                                                                      }
                                                                        else
                                                                        {
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.BarChartListInteropModule @ref=_bclim_33 co=@elem.barOption pcd=@elem.pieDatasetList bcd=@elem.barDatasetList lbls=@elem.barDatasetLabels/>
                                                                        }
                                                                         break;
                                                                          case 34:
                                                                           @if(isPie){
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.PieChartListInteropModule @ref=_pclim_34  co=@elem.pieOption pcd=@elem.pieDatasetList lbls=@elem.pieDatasetLabels/>
                                                                      }
                                                                        else
                                                                        {
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.BarChartListInteropModule @ref=_bclim_34 co=@elem.barOption pcd=@elem.pieDatasetList bcd=@elem.barDatasetList lbls=@elem.barDatasetLabels/>
                                                                        }
                                                                         break;
                                                                          case 35:
                                                                           @if(isPie){
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.PieChartListInteropModule @ref=_pclim_35  co=@elem.pieOption pcd=@elem.pieDatasetList lbls=@elem.pieDatasetLabels/>
                                                                      }
                                                                        else
                                                                        {
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.BarChartListInteropModule @ref=_bclim_35 co=@elem.barOption pcd=@elem.pieDatasetList bcd=@elem.barDatasetList lbls=@elem.barDatasetLabels/>
                                                                        }
                                                                         break;
                                                                          case 36:
                                                                           @if(isPie){
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.PieChartListInteropModule @ref=_pclim_36  co=@elem.pieOption pcd=@elem.pieDatasetList lbls=@elem.pieDatasetLabels/>
                                                                      }
                                                                        else
                                                                        {
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.BarChartListInteropModule @ref=_bclim_36 co=@elem.barOption pcd=@elem.pieDatasetList bcd=@elem.barDatasetList lbls=@elem.barDatasetLabels/>
                                                                        }
                                                                        break;
                                                                    case 37:
                                                                           @if(isPie){
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.PieChartListInteropModule @ref=_pclim_37  co=@elem.pieOption pcd=@elem.pieDatasetList lbls=@elem.pieDatasetLabels/>
                                                                      }
                                                                        else
                                                                        {
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.BarChartListInteropModule @ref=_bclim_37 co=@elem.barOption pcd=@elem.pieDatasetList bcd=@elem.barDatasetList lbls=@elem.barDatasetLabels/>
                                                                        }
                                                                         break;
                                                                          case 38:
                                                                           @if(isPie){
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.PieChartListInteropModule @ref=_pclim_38  co=@elem.pieOption pcd=@elem.pieDatasetList lbls=@elem.pieDatasetLabels/>
                                                                      }
                                                                        else
                                                                        {
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.BarChartListInteropModule @ref=_bclim_38 co=@elem.barOption pcd=@elem.pieDatasetList bcd=@elem.barDatasetList lbls=@elem.barDatasetLabels/>
                                                                        }
                                                                         break;
                                                                          case 39:
                                                                           @if(isPie){
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.PieChartListInteropModule @ref=_pclim_39  co=@elem.pieOption pcd=@elem.pieDatasetList lbls=@elem.pieDatasetLabels/>
                                                                      }
                                                                        else
                                                                        {
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.BarChartListInteropModule @ref=_bclim_39 co=@elem.barOption pcd=@elem.pieDatasetList bcd=@elem.barDatasetList lbls=@elem.barDatasetLabels/>
                                                                        }
                                                                         break;
                                                                          case 40:
                                                                           @if(isPie){
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.PieChartListInteropModule @ref=_pclim_40  co=@elem.pieOption pcd=@elem.pieDatasetList lbls=@elem.pieDatasetLabels/>
                                                                      }
                                                                        else
                                                                        {
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.BarChartListInteropModule @ref=_bclim_40 co=@elem.barOption pcd=@elem.pieDatasetList bcd=@elem.barDatasetList lbls=@elem.barDatasetLabels/>
                                                                        }
                                                                         break;
                                                                          case 41:
                                                                           @if(isPie){
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.PieChartListInteropModule @ref=_pclim_41  co=@elem.pieOption pcd=@elem.pieDatasetList lbls=@elem.pieDatasetLabels/>
                                                                      }
                                                                        else
                                                                        {
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.BarChartListInteropModule @ref=_bclim_41 co=@elem.barOption pcd=@elem.pieDatasetList bcd=@elem.barDatasetList lbls=@elem.barDatasetLabels/>
                                                                        }
                                                                         break;
                                                                          case 42:
                                                                           @if(isPie){
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.PieChartListInteropModule @ref=_pclim_42  co=@elem.pieOption pcd=@elem.pieDatasetList lbls=@elem.pieDatasetLabels/>
                                                                      }
                                                                        else
                                                                        {
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.BarChartListInteropModule @ref=_bclim_42 co=@elem.barOption pcd=@elem.pieDatasetList bcd=@elem.barDatasetList lbls=@elem.barDatasetLabels/>
                                                                        }
                                                                        break;
                                                                    case 43:
                                                                           @if(isPie){
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.PieChartListInteropModule @ref=_pclim_43  co=@elem.pieOption pcd=@elem.pieDatasetList lbls=@elem.pieDatasetLabels/>
                                                                      }
                                                                        else
                                                                        {
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.BarChartListInteropModule @ref=_bclim_43 co=@elem.barOption pcd=@elem.pieDatasetList bcd=@elem.barDatasetList lbls=@elem.barDatasetLabels/>
                                                                        }
                                                                         break;
                                                                          case 44:
                                                                           @if(isPie){
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.PieChartListInteropModule @ref=_pclim_44  co=@elem.pieOption pcd=@elem.pieDatasetList lbls=@elem.pieDatasetLabels/>
                                                                      }
                                                                        else
                                                                        {
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.BarChartListInteropModule @ref=_bclim_44 co=@elem.barOption pcd=@elem.pieDatasetList bcd=@elem.barDatasetList lbls=@elem.barDatasetLabels/>
                                                                        }
                                                                         break;
                                                                          case 45:
                                                                           @if(isPie){
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.PieChartListInteropModule @ref=_pclim_45  co=@elem.pieOption pcd=@elem.pieDatasetList lbls=@elem.pieDatasetLabels/>
                                                                      }
                                                                        else
                                                                        {
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.BarChartListInteropModule @ref=_bclim_45 co=@elem.barOption pcd=@elem.pieDatasetList bcd=@elem.barDatasetList lbls=@elem.barDatasetLabels/>
                                                                        }
                                                                         break;
                                                                          case 46:
                                                                           @if(isPie){
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.PieChartListInteropModule @ref=_pclim_46  co=@elem.pieOption pcd=@elem.pieDatasetList lbls=@elem.pieDatasetLabels/>
                                                                      }
                                                                        else
                                                                        {
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.BarChartListInteropModule @ref=_bclim_46 co=@elem.barOption pcd=@elem.pieDatasetList bcd=@elem.barDatasetList lbls=@elem.barDatasetLabels/>
                                                                        }
                                                                         break;
                                                                          case 47:
                                                                           @if(isPie){
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.PieChartListInteropModule @ref=_pclim_47  co=@elem.pieOption pcd=@elem.pieDatasetList lbls=@elem.pieDatasetLabels/>
                                                                      }
                                                                        else
                                                                        {
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.BarChartListInteropModule @ref=_bclim_47 co=@elem.barOption pcd=@elem.pieDatasetList bcd=@elem.barDatasetList lbls=@elem.barDatasetLabels/>
                                                                        }
                                                                         break;
                                                                          case 48:
                                                                           @if(isPie){
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.PieChartListInteropModule @ref=_pclim_48  co=@elem.pieOption pcd=@elem.pieDatasetList lbls=@elem.pieDatasetLabels/>
                                                                      }
                                                                        else
                                                                        {
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.BarChartListInteropModule @ref=_bclim_48 co=@elem.barOption pcd=@elem.pieDatasetList bcd=@elem.barDatasetList lbls=@elem.barDatasetLabels/>
                                                                        }
                                                                         break;
                                                                          case 49:
                                                                           @if(isPie){
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.PieChartListInteropModule @ref=_pclim_49  co=@elem.pieOption pcd=@elem.pieDatasetList lbls=@elem.pieDatasetLabels/>
                                                                      }
                                                                        else
                                                                        {
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.BarChartListInteropModule @ref=_bclim_49 co=@elem.barOption pcd=@elem.pieDatasetList bcd=@elem.barDatasetList lbls=@elem.barDatasetLabels/>
                                                                        }
                                                                         break;
                                                                          case 50:
                                                                           @if(isPie){
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.PieChartListInteropModule @ref=_pclim_50  co=@elem.pieOption pcd=@elem.pieDatasetList lbls=@elem.pieDatasetLabels/>
                                                                      }
                                                                        else
                                                                        {
                                                                         <EviCRM.Server.Pages.Charts.ChartListInterop.BarChartListInteropModule @ref=_bclim_50 co=@elem.barOption pcd=@elem.pieDatasetList bcd=@elem.barDatasetList lbls=@elem.barDatasetLabels/>
                                                                        }
                                                                         break;
                                                                         break;
                                                                         break;
                                                                }

                                                                </div>
                                                               
                                                            </td>

                                                            <td>@elem.getAverage()</td>

                                                            <td>
                                                               
                                                                        @switch (lcl_view_plus)
                                                                        {
                                                                    
                                                                          case 1:
                                                                         <div style="position: relative; margin-left: auto; margin-right: auto;">
                                                                              <EviCRM.Server.Pages.Charts.ChartListInterop.LineChartListInteropModule @ref=_lclim_1 lcd=@elem._lineDatasetList2 isInterpolation=@InterpolationCatsString />
                                                                         </div>
                                                                         break;
                                                                          case 2:
                                                                         <div style="position: relative; margin-left: auto; margin-right: auto;">
                                                                              <EviCRM.Server.Pages.Charts.ChartListInterop.LineChartListInteropModule @ref=_lclim_2 lcd=@elem._lineDatasetList2 isInterpolation=@InterpolationCatsString/>
                                                                         </div>
                                                                         break;
                                                                          case 3:
                                                                         <div style="position: relative; margin-left: auto; margin-right: auto;">
                                                                              <EviCRM.Server.Pages.Charts.ChartListInterop.LineChartListInteropModule @ref=_lclim_3 lcd=@elem._lineDatasetList2 isInterpolation=@InterpolationCatsString/>
                                                                         </div>
                                                                         break;
                                                                          case 4:
                                                                         <div style="position: relative; margin-left: auto; margin-right: auto;">
                                                                              <EviCRM.Server.Pages.Charts.ChartListInterop.LineChartListInteropModule @ref=_lclim_4 lcd=@elem._lineDatasetList2 isInterpolation=@InterpolationCatsString/>
                                                                         </div>
                                                                         break;
                                                                          case 5:
                                                                         <div style="position: relative; margin-left: auto; margin-right: auto;">
                                                                              <EviCRM.Server.Pages.Charts.ChartListInterop.LineChartListInteropModule @ref=_lclim_5 lcd=@elem._lineDatasetList2 isInterpolation=@InterpolationCatsString/>
                                                                         </div>
                                                                         break;
                                                                          case 6:
                                                                         <div style="position: relative; margin-left: auto; margin-right: auto;">
                                                                              <EviCRM.Server.Pages.Charts.ChartListInterop.LineChartListInteropModule @ref=_lclim_6 lcd=@elem._lineDatasetList2 isInterpolation=@InterpolationCatsString/>
                                                                         </div>
                                                                         break;
                                                                          case 7:
                                                                         <div style="position: relative; margin-left: auto; margin-right: auto;">
                                                                              <EviCRM.Server.Pages.Charts.ChartListInterop.LineChartListInteropModule @ref=_lclim_7 lcd=@elem._lineDatasetList2 isInterpolation=@InterpolationCatsString/>
                                                                         </div>
                                                                         break;
                                                                          case 8:
                                                                         <div style="position: relative; margin-left: auto; margin-right: auto;">
                                                                              <EviCRM.Server.Pages.Charts.ChartListInterop.LineChartListInteropModule @ref=_lclim_8 lcd=@elem._lineDatasetList2 isInterpolation=@InterpolationCatsString/>
                                                                         </div>
                                                                         break;
                                                                          case 9:
                                                                         <div style="position: relative; margin-left: auto; margin-right: auto;">
                                                                              <EviCRM.Server.Pages.Charts.ChartListInterop.LineChartListInteropModule @ref=_lclim_9 lcd=@elem._lineDatasetList2 isInterpolation=@InterpolationCatsString/>
                                                                         </div>
                                                                         break;
                                                                          case 10:
                                                                         <div style="position: relative; margin-left: auto; margin-right: auto;">
                                                                              <EviCRM.Server.Pages.Charts.ChartListInterop.LineChartListInteropModule @ref=_lclim_10 lcd=@elem._lineDatasetList2 isInterpolation=@InterpolationCatsString/>
                                                                         </div>
                                                                         break;
                                                                          case 11:
                                                                         <div style="position: relative; margin-left: auto; margin-right: auto;">
                                                                              <EviCRM.Server.Pages.Charts.ChartListInterop.LineChartListInteropModule @ref=_lclim_11 lcd=@elem._lineDatasetList2 isInterpolation=@InterpolationCatsString/>
                                                                         </div>
                                                                         break;
                                                                          case 12:
                                                                         <div style="position: relative; margin-left: auto; margin-right: auto;">
                                                                              <EviCRM.Server.Pages.Charts.ChartListInterop.LineChartListInteropModule @ref=_lclim_12 lcd=@elem._lineDatasetList2 isInterpolation=@InterpolationCatsString/>
                                                                         </div>
                                                                         break;
                                                                          case 13:
                                                                         <div style="position: relative; margin-left: auto; margin-right: auto;">
                                                                              <EviCRM.Server.Pages.Charts.ChartListInterop.LineChartListInteropModule @ref=_lclim_13 lcd=@elem._lineDatasetList2 isInterpolation=@InterpolationCatsString/>
                                                                         </div>
                                                                         break;
                                                                          case 14:
                                                                         <div style="position: relative; margin-left: auto; margin-right: auto;">
                                                                              <EviCRM.Server.Pages.Charts.ChartListInterop.LineChartListInteropModule @ref=_lclim_14 lcd=@elem._lineDatasetList2 isInterpolation=@InterpolationCatsString/>
                                                                         </div>
                                                                         break;
                                                                          case 15:
                                                                         <div style="position: relative; margin-left: auto; margin-right: auto;">
                                                                              <EviCRM.Server.Pages.Charts.ChartListInterop.LineChartListInteropModule @ref=_lclim_15 lcd=@elem._lineDatasetList2 isInterpolation=@InterpolationCatsString/>
                                                                         </div>
                                                                         break;
                                                                          case 16:
                                                                         <div style="position: relative; margin-left: auto; margin-right: auto;">
                                                                              <EviCRM.Server.Pages.Charts.ChartListInterop.LineChartListInteropModule @ref=_lclim_16 lcd=@elem._lineDatasetList2 isInterpolation=@InterpolationCatsString/>
                                                                         </div>
                                                                         break;

                                                                         case 17:
                                                                         <div style="position: relative; margin-left: auto; margin-right: auto;">
                                                                              <EviCRM.Server.Pages.Charts.ChartListInterop.LineChartListInteropModule @ref=_lclim_17 lcd=@elem._lineDatasetList2 isInterpolation=@InterpolationCatsString />
                                                                         </div>
                                                                         break;
                                                                          case 18:
                                                                         <div style="position: relative; margin-left: auto; margin-right: auto;">
                                                                              <EviCRM.Server.Pages.Charts.ChartListInterop.LineChartListInteropModule @ref=_lclim_18 lcd=@elem._lineDatasetList2 isInterpolation=@InterpolationCatsString/>
                                                                         </div>
                                                                         break;
                                                                          case 19:
                                                                         <div style="position: relative; margin-left: auto; margin-right: auto;">
                                                                              <EviCRM.Server.Pages.Charts.ChartListInterop.LineChartListInteropModule @ref=_lclim_19 lcd=@elem._lineDatasetList2 isInterpolation=@InterpolationCatsString/>
                                                                         </div>
                                                                         break;
                                                                          case 20:
                                                                         <div style="position: relative; margin-left: auto; margin-right: auto;">
                                                                              <EviCRM.Server.Pages.Charts.ChartListInterop.LineChartListInteropModule @ref=_lclim_20 lcd=@elem._lineDatasetList2 isInterpolation=@InterpolationCatsString/>
                                                                         </div>
                                                                         break;
                                                                          case 21:
                                                                         <div style="position: relative; margin-left: auto; margin-right: auto;">
                                                                              <EviCRM.Server.Pages.Charts.ChartListInterop.LineChartListInteropModule @ref=_lclim_21 lcd=@elem._lineDatasetList2 isInterpolation=@InterpolationCatsString/>
                                                                         </div>
                                                                         break;
                                                                          case 22:
                                                                         <div style="position: relative; margin-left: auto; margin-right: auto;">
                                                                              <EviCRM.Server.Pages.Charts.ChartListInterop.LineChartListInteropModule @ref=_lclim_22 lcd=@elem._lineDatasetList2 isInterpolation=@InterpolationCatsString/>
                                                                         </div>
                                                                         break;
                                                                          case 23:
                                                                         <div style="position: relative; margin-left: auto; margin-right: auto;">
                                                                              <EviCRM.Server.Pages.Charts.ChartListInterop.LineChartListInteropModule @ref=_lclim_23 lcd=@elem._lineDatasetList2 isInterpolation=@InterpolationCatsString/>
                                                                         </div>
                                                                         break;
                                                                          case 24:
                                                                         <div style="position: relative; margin-left: auto; margin-right: auto;">
                                                                              <EviCRM.Server.Pages.Charts.ChartListInterop.LineChartListInteropModule @ref=_lclim_24 lcd=@elem._lineDatasetList2 isInterpolation=@InterpolationCatsString/>
                                                                         </div>
                                                                         break;
                                                                          case 25:
                                                                         <div style="position: relative; margin-left: auto; margin-right: auto;">
                                                                              <EviCRM.Server.Pages.Charts.ChartListInterop.LineChartListInteropModule @ref=_lclim_25 lcd=@elem._lineDatasetList2 isInterpolation=@InterpolationCatsString/>
                                                                         </div>
                                                                         break;
                                                                          case 26:
                                                                         <div style="position: relative; margin-left: auto; margin-right: auto;">
                                                                              <EviCRM.Server.Pages.Charts.ChartListInterop.LineChartListInteropModule @ref=_lclim_26 lcd=@elem._lineDatasetList2 isInterpolation=@InterpolationCatsString/>
                                                                    </div>
                                                                    break;
                                                                case 27:
                                                                         <div style="position: relative; margin-left: auto; margin-right: auto;">
                                                                              <EviCRM.Server.Pages.Charts.ChartListInterop.LineChartListInteropModule @ref=_lclim_27 lcd=@elem._lineDatasetList2 isInterpolation=@InterpolationCatsString/>
                                                                         </div>
                                                                         break;
                                                                          case 28:
                                                                         <div style="position: relative; margin-left: auto; margin-right: auto;">
                                                                              <EviCRM.Server.Pages.Charts.ChartListInterop.LineChartListInteropModule @ref=_lclim_28 lcd=@elem._lineDatasetList2 isInterpolation=@InterpolationCatsString/>
                                                                         </div>
                                                                         break;
                                                                          case 29:
                                                                         <div style="position: relative; margin-left: auto; margin-right: auto;">
                                                                              <EviCRM.Server.Pages.Charts.ChartListInterop.LineChartListInteropModule @ref=_lclim_29 lcd=@elem._lineDatasetList2 isInterpolation=@InterpolationCatsString/>
                                                                    </div>
                                                                    break;
                                                                          case 30:
                                                                         <div style="position: relative; margin-left: auto; margin-right: auto;">
                                                                              <EviCRM.Server.Pages.Charts.ChartListInterop.LineChartListInteropModule @ref=_lclim_30 lcd=@elem._lineDatasetList2 isInterpolation=@InterpolationCatsString/>
                                                                         </div>
                                                                         break;
                                                                        
                                                                          case 31:
                                                                         <div style="position: relative; margin-left: auto; margin-right: auto;">
                                                                              <EviCRM.Server.Pages.Charts.ChartListInterop.LineChartListInteropModule @ref=_lclim_31 lcd=@elem._lineDatasetList2 isInterpolation=@InterpolationCatsString/>
                                                                         </div>
                                                                         break;
                                                                          case 32:
                                                                         <div style="position: relative; margin-left: auto; margin-right: auto;">
                                                                              <EviCRM.Server.Pages.Charts.ChartListInterop.LineChartListInteropModule @ref=_lclim_32 lcd=@elem._lineDatasetList2 isInterpolation=@InterpolationCatsString/>
                                                                         </div>
                                                                         break;
                                                                          case 33:
                                                                         <div style="position: relative; margin-left: auto; margin-right: auto;">
                                                                              <EviCRM.Server.Pages.Charts.ChartListInterop.LineChartListInteropModule @ref=_lclim_33 lcd=@elem._lineDatasetList2 isInterpolation=@InterpolationCatsString/>
                                                                         </div>
                                                                         break;
                                                                          case 34:
                                                                         <div style="position: relative; margin-left: auto; margin-right: auto;">
                                                                              <EviCRM.Server.Pages.Charts.ChartListInterop.LineChartListInteropModule @ref=_lclim_34 lcd=@elem._lineDatasetList2 isInterpolation=@InterpolationCatsString/>
                                                                         </div>
                                                                         break;
                                                                          case 35:
                                                                         <div style="position: relative; margin-left: auto; margin-right: auto;">
                                                                              <EviCRM.Server.Pages.Charts.ChartListInterop.LineChartListInteropModule @ref=_lclim_35 lcd=@elem._lineDatasetList2 isInterpolation=@InterpolationCatsString/>
                                                                         </div>
                                                                         break;
                                                                          case 36:
                                                                         <div style="position: relative; margin-left: auto; margin-right: auto;">
                                                                              <EviCRM.Server.Pages.Charts.ChartListInterop.LineChartListInteropModule @ref=_lclim_36 lcd=@elem._lineDatasetList2 isInterpolation=@InterpolationCatsString/>
                                                                         </div>
                                                                         break;

                                                                         case 37:
                                                                         <div style="position: relative; margin-left: auto; margin-right: auto;">
                                                                              <EviCRM.Server.Pages.Charts.ChartListInterop.LineChartListInteropModule @ref=_lclim_37 lcd=@elem._lineDatasetList2 isInterpolation=@InterpolationCatsString />
                                                                         </div>
                                                                         break;

                                                                          case 38:
                                                                         <div style="position: relative; margin-left: auto; margin-right: auto;">
                                                                              <EviCRM.Server.Pages.Charts.ChartListInterop.LineChartListInteropModule @ref=_lclim_38 lcd=@elem._lineDatasetList2 isInterpolation=@InterpolationCatsString/>
                                                                         </div>
                                                                         break;
                                                                          case 39:
                                                                         <div style="position: relative; margin-left: auto; margin-right: auto;">
                                                                              <EviCRM.Server.Pages.Charts.ChartListInterop.LineChartListInteropModule @ref=_lclim_39 lcd=@elem._lineDatasetList2 isInterpolation=@InterpolationCatsString/>
                                                                         </div>
                                                                         break;

                                                                          case 40:
                                                                         <div style="position: relative; margin-left: auto; margin-right: auto;">
                                                                              <EviCRM.Server.Pages.Charts.ChartListInterop.LineChartListInteropModule @ref=_lclim_40 lcd=@elem._lineDatasetList2 isInterpolation=@InterpolationCatsString/>
                                                                         </div>
                                                                         break;
                                                                          case 41:
                                                                         <div style="position: relative; margin-left: auto; margin-right: auto;">
                                                                              <EviCRM.Server.Pages.Charts.ChartListInterop.LineChartListInteropModule @ref=_lclim_41 lcd=@elem._lineDatasetList2 isInterpolation=@InterpolationCatsString/>
                                                                         </div>
                                                                         break;
                                                                          case 42:
                                                                         <div style="position: relative; margin-left: auto; margin-right: auto;">
                                                                              <EviCRM.Server.Pages.Charts.ChartListInterop.LineChartListInteropModule @ref=_lclim_42 lcd=@elem._lineDatasetList2 isInterpolation=@InterpolationCatsString/>
                                                                         </div>
                                                                         break;
                                                                          case 43:
                                                                         <div style="position: relative; margin-left: auto; margin-right: auto;">
                                                                              <EviCRM.Server.Pages.Charts.ChartListInterop.LineChartListInteropModule @ref=_lclim_43 lcd=@elem._lineDatasetList2 isInterpolation=@InterpolationCatsString/>
                                                                         </div>
                                                                         break;
                                                                          case 44:
                                                                         <div style="position: relative; margin-left: auto; margin-right: auto;">
                                                                              <EviCRM.Server.Pages.Charts.ChartListInterop.LineChartListInteropModule @ref=_lclim_44 lcd=@elem._lineDatasetList2 isInterpolation=@InterpolationCatsString/>
                                                                         </div>
                                                                         break;
                                                                          case 45:
                                                                         <div style="position: relative; margin-left: auto; margin-right: auto;">
                                                                              <EviCRM.Server.Pages.Charts.ChartListInterop.LineChartListInteropModule @ref=_lclim_45 lcd=@elem._lineDatasetList2 isInterpolation=@InterpolationCatsString/>
                                                                         </div>
                                                                         break;
                                                                          case 46:
                                                                         <div style="position: relative; margin-left: auto; margin-right: auto;">
                                                                              <EviCRM.Server.Pages.Charts.ChartListInterop.LineChartListInteropModule @ref=_lclim_46 lcd=@elem._lineDatasetList2 isInterpolation=@InterpolationCatsString/>
                                                                         </div>
                                                                         break;
                                                                         case 47:
                                                                         <div style="position: relative; margin-left: auto; margin-right: auto;">
                                                                              <EviCRM.Server.Pages.Charts.ChartListInterop.LineChartListInteropModule @ref=_lclim_47 lcd=@elem._lineDatasetList2 isInterpolation=@InterpolationCatsString />
                                                                         </div>
                                                                         break;
                                                                          case 48:
                                                                         <div style="position: relative; margin-left: auto; margin-right: auto;">
                                                                              <EviCRM.Server.Pages.Charts.ChartListInterop.LineChartListInteropModule @ref=_lclim_48 lcd=@elem._lineDatasetList2 isInterpolation=@InterpolationCatsString/>
                                                                         </div>
                                                                         break;
                                                                          case 49:
                                                                         <div style="position: relative; margin-left: auto; margin-right: auto;">
                                                                              <EviCRM.Server.Pages.Charts.ChartListInterop.LineChartListInteropModule @ref=_lclim_49 lcd=@elem._lineDatasetList2 isInterpolation=@InterpolationCatsString/>
                                                                         </div>
                                                                         break;

                                                                          case 50:
                                                                         <div style="position: relative; margin-left: auto; margin-right: auto;">
                                                                              <EviCRM.Server.Pages.Charts.ChartListInterop.LineChartListInteropModule @ref=_lclim_50 lcd=@elem._lineDatasetList2 isInterpolation=@InterpolationCatsString/>
                                                                         </div>
                                                                         break;

                                                                         }
                                                            </td>
                                                            <td>

                                                                @if (elem.getAvgDeviation(avg_company) > 0)
                                                                {
                                                                    //Зелёный
                                                                    <p>Отклонение : <font color="green"> + @elem.getAvgDeviation(avg_company).ToString("N3")</font> <br />
                                                                    На <font color="green">@elem.getDifferencePercentage(avg_company).ToString("N3") % сильнее среднего</font>
                                                                    </p>
                                                                }
                                                                else if (elem.getAvgDeviation(avg_company) < 0)
                                                                {
                                                                    <p>Отклонение : <font color="red"> @elem.getAvgDeviation(avg_company).ToString("N3")</font>
                                                                    <br />
                                                                    На <font color="red">@(((-1)*elem.getDifferencePercentage(avg_company)).ToString("N3")) % слабее среднего</font>
                                                                    </p>
                                                                }
                                                                else
                                                                {
                                                                    <font color="grey">+ / - 0 [ 0.00 % ]</font>
                                                                }

                                                            </td>
                                                        </tr>
                                                         }
                                                           i_visible++;
               
                                                }
                                                i_cnt++;
                                             
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            }
            else
            {

            }

        }
        else
        {
            <h4><i class="bx bx-buoy bx-spin text-primary display-3"></i>Загружаю информацию...</h4>
        }
            
    </Authorized>
    <NotAuthorized>
        <AuthorizationPrompt Title="Вам необходимо зарегистрироваться или войти! " />
    </NotAuthorized>
</AuthorizeView>  

@code{

    List<schema_users> Users = new List<schema_users>();
    List<schema_marks> Marks = new List<schema_marks>();
    schema_users Selected_User = new();

        bool end_loop { get; set; }

        public string InterpolationCatsString { get; set; }

      bool personal { get; set; } //Переключатель общей и персональной статистики

     DateTime dt_start { get; set; } //Выбранная дата начала

        DateTime dt_end { get; set; } //Выранная дата конца

         public enum StatWindow
        {
            personal,
            common
        };

        public enum InterpolationCats
        {
            disabled,
            enabled,
            stepbefore,
            stepafter,
            stepmiddle
        };

         public string StatWindowString { get; set; }
        public string StatWindowString2 { get; set; }

        public string isPieString
        {
            get
            {
                if (isPie)
                {
                    return "True";
                }
                else
                {
                    return "False";
                }
            }
            set
            {
                if (value == "True")
                {
                    isPie = true;
                    StateHasChanged();
                }
                else
                {
                    isPie = false;
                    StateHasChanged();
                }
            }
            
        }

        public bool isTop { get; set; } //Включено отображение топ

        public bool isOnlyWithMarks { get; set; } //Показывать только с оценками

        public int TopNumber { get; set; } //ТОП скольки

        public int svp_index { get; set; }

        public List<StatisticsViewModel_Pie> svmp_main = new List<StatisticsViewModel_Pie>();


        double avg_company { get; set; } 

        double academic_perfomace_company { get; set; }

        double quality_of_work_company { get; set; }

        double perfomance_company { get; set; }

        bool isPie { get; set; }

        public string modal_user { get; set; }

        public int num { get; set; }

}

@code{
    //System operation block

    #region System operation block

    bool isModalPieOpen { get; set; }
    bool modalAllow { get; set; }

    string _personal_users { get; set; }

    string personal_users { get; set; }

    string personal_users_k { get; set; }

    private void OnModalPieBarClose(bool accepted)
    {
        isModalPieOpen = false;
        StateHasChanged();

    }

    private void OpenModalPieBarDialog()
    {
        isModalPieOpen = true;
        StateHasChanged();
    }

    public async Task isOnlyWithMarksHandler(ChangeEventArgs cea)
    {
        isOnlyWithMarks = bool.Parse(cea.Value.ToString());
        await InvokeAsync(StateHasChanged);

    }

    public async Task topnumber_changed(ChangeEventArgs cea)
    {
        if (int.TryParse(cea.Value.ToString(),out int a))
        {
            TopNumber = a;
        ModelSort(true);
        
       await InvokeAsync(StateHasChanged);
            }
    }

    public async Task isTopChange(ChangeEventArgs cea)
    {
        if (bool.TryParse(cea.Value.ToString(),out bool a))
        {
             isTop = a;
        ModelSort(true);
        await InvokeAsync(StateHasChanged);
        }
    }

    public async Task DateStartChangeHandler(ChangeEventArgs e)
    {
        if (e.Value != null)
        {
            if (e.Value.ToString() != null)
            {
                DateTime dt_start2 = DateTime.Parse(e.Value.ToString());

                if (dt_start2.Date == DateTime.Now.Date && dt_end.Date == DateTime.Now.Date)
                {
                    await LoadDataList();
                }
                else
                {
                    await LoadDataList(dt_start2, dt_end);
                }
                await getCompanyEvaluations();
                await InvokeAsync(StateHasChanged);
            }
        }

    }

    public async Task DateEndChangeHandler(ChangeEventArgs e)
    {
        if (e.Value != null)
        {
            if (e.Value.ToString() != null)
            {

                DateTime dt_end2 = DateTime.Parse(e.Value.ToString());
                //dt_end = DateTime.Parse(e.Value.ToString());

                if (dt_start.Date == DateTime.Now.Date && dt_end2.Date == DateTime.Now.Date)
                {
                    await LoadDataList();
                }
                else
                {
                    await LoadDataList(dt_start, dt_end2);
                }
                await InvokeAsync(StateHasChanged);
            }
        }
    }
        #endregion


}